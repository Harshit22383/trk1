<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tourist Raksha Kavach</title>
    <style>
        :root {
            --color-cream-50: rgba(252, 252, 249, 1);
            --color-cream-100: rgba(255, 255, 253, 1);
            --color-gray-200: rgba(245, 245, 245, 1);
            --color-gray-300: rgba(167, 169, 169, 1);
            --color-slate-500: rgba(98, 108, 113, 1);
            --color-brown-600: rgba(94, 82, 64, 1);
            --color-charcoal-700: rgba(31, 33, 33, 1);
            --color-charcoal-800: rgba(38, 40, 40, 1);
            --color-slate-900: rgba(19, 52, 59, 1);
            --color-teal-300: rgba(50, 184, 198, 1);
            --color-teal-500: rgba(33, 128, 141, 1);
            --color-teal-600: rgba(29, 116, 128, 1);
            --color-teal-700: rgba(26, 104, 115, 1);
            --color-red-400: rgba(255, 84, 89, 1);
            --color-red-500: rgba(192, 21, 47, 1);
            --color-orange-500: rgba(168, 75, 47, 1);

            --color-brown-600-rgb: 94, 82, 64;
            --color-teal-500-rgb: 33, 128, 141;
            --color-slate-900-rgb: 19, 52, 59;
            --color-red-500-rgb: 192, 21, 47;

            --color-background: var(--color-cream-50);
            --color-surface: var(--color-cream-100);
            --color-text: var(--color-slate-900);
            --color-text-secondary: var(--color-slate-500);
            --color-primary: var(--color-teal-500);
            --color-primary-hover: var(--color-teal-600);
            --color-primary-active: var(--color-teal-700);
            --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
            --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
            --color-border: rgba(var(--color-brown-600-rgb), 0.2);
            --color-btn-primary-text: var(--color-cream-50);
            --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
            --color-error: var(--color-red-500);
            --color-success: var(--color-teal-500);
            --color-warning: var(--color-orange-500);
            --color-focus-ring: rgba(var(--color-teal-500-rgb), 0.4);

            --font-family-base: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            --font-size-sm: 12px;
            --font-size-base: 14px;
            --font-size-lg: 16px;
            --font-size-xl: 18px;
            --font-size-2xl: 20px;
            --font-size-3xl: 24px;
            --font-weight-medium: 500;
            --font-weight-semibold: 550;
            --font-weight-bold: 600;

            --space-4: 4px;
            --space-8: 8px;
            --space-12: 12px;
            --space-16: 16px;
            --space-20: 20px;
            --space-24: 24px;
            --space-32: 32px;

            --radius-base: 8px;
            --radius-md: 10px;
            --radius-lg: 12px;
            --radius-full: 9999px;

            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04), 0 2px 4px -1px rgba(0, 0, 0, 0.02);

            --duration-fast: 150ms;
            --duration-normal: 250ms;
            --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --color-gray-400-rgb: 119, 124, 124;
                --color-teal-300-rgb: 50, 184, 198;
                --color-gray-300-rgb: 167, 169, 169;
                --color-gray-200-rgb: 245, 245, 245;

                --color-background: var(--color-charcoal-700);
                --color-surface: var(--color-charcoal-800);
                --color-text: var(--color-gray-200);
                --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
                --color-primary: var(--color-teal-300);
                --color-primary-hover: rgba(45, 166, 178, 1);
                --color-primary-active: rgba(41, 150, 161, 1);
                --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
                --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
                --color-border: rgba(var(--color-gray-400-rgb), 0.3);
                --color-error: var(--color-red-400);
                --color-success: var(--color-teal-300);
                --color-btn-primary-text: var(--color-slate-900);
                --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
                --color-focus-ring: rgba(var(--color-teal-300-rgb), 0.4);
            }
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-family-base);
            font-size: var(--font-size-base);
            background-color: var(--color-background);
            color: var(--color-text);
            line-height: 1.5;
        }

        .app-container {
            max-width: 480px;
            margin: 0 auto;
            min-height: 100vh;
            background-color: var(--color-surface);
            box-shadow: var(--shadow-md);
        }

        .header {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-hover) 100%);
            color: var(--color-btn-primary-text);
            padding: var(--space-20) var(--space-16);
            text-align: center;
        }

        .header h1 {
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-bold);
            margin-bottom: var(--space-4);
        }

        .header p {
            font-size: var(--font-size-sm);
            opacity: 0.9;
        }

        .content {
            padding: var(--space-24) var(--space-16);
        }

        .auth-form {
            max-width: 400px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: var(--space-16);
        }

        .form-label {
            display: block;
            margin-bottom: var(--space-8);
            font-weight: var(--font-weight-medium);
            font-size: var(--font-size-sm);
            color: var(--color-text);
        }

        .form-control {
            width: 100%;
            padding: var(--space-12);
            font-size: var(--font-size-base);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            background-color: var(--color-surface);
            color: var(--color-text);
            transition: border-color var(--duration-fast) var(--ease-standard);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px var(--color-focus-ring);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-12) var(--space-24);
            border-radius: var(--radius-base);
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            transition: all var(--duration-normal) var(--ease-standard);
            border: none;
            width: 100%;
            gap: var(--space-8);
        }

        .btn--primary {
            background: var(--color-primary);
            color: var(--color-btn-primary-text);
        }

        .btn--primary:hover {
            background: var(--color-primary-hover);
        }

        .btn--primary:active {
            background: var(--color-primary-active);
        }

        .btn--secondary {
            background: var(--color-secondary);
            color: var(--color-text);
        }

        .btn--secondary:hover {
            background: var(--color-secondary-hover);
        }

        .btn--danger {
            background: var(--color-error);
            color: var(--color-cream-50);
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            padding: var(--space-24);
            border-radius: var(--radius-full);
            width: 200px;
            height: 200px;
            margin: var(--space-32) auto;
            box-shadow: 0 8px 20px rgba(var(--color-red-500-rgb), 0.3);
        }

        .btn--danger:hover {
            background: rgba(var(--color-red-500-rgb), 0.9);
            transform: scale(1.05);
        }

        .btn--danger:active {
            transform: scale(0.95);
        }

        .btn--small {
            padding: var(--space-8) var(--space-16);
            font-size: var(--font-size-sm);
        }

        .text-link {
            color: var(--color-primary);
            text-decoration: none;
            font-size: var(--font-size-sm);
            text-align: center;
            display: block;
            margin-top: var(--space-16);
            cursor: pointer;
        }

        .text-link:hover {
            text-decoration: underline;
        }

        .contact-card {
            background-color: var(--color-surface);
            border: 1px solid var(--color-card-border);
            border-radius: var(--radius-lg);
            padding: var(--space-16);
            margin-bottom: var(--space-12);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow-sm);
        }

        .contact-info h3 {
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-semibold);
            margin-bottom: var(--space-4);
        }

        .contact-info p {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
        }

        .emergency-services {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-12);
            margin-top: var(--space-24);
        }

        .service-btn {
            padding: var(--space-16);
            background: var(--color-secondary);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            cursor: pointer;
            text-align: center;
            transition: all var(--duration-fast) var(--ease-standard);
        }

        .service-btn:hover {
            background: var(--color-secondary-hover);
            transform: translateY(-2px);
        }

        .service-btn-icon {
            font-size: var(--font-size-3xl);
            margin-bottom: var(--space-8);
        }

        .service-btn-label {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
        }

        .service-btn-number {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            margin-top: var(--space-4);
        }

        .location-display {
            background: var(--color-secondary);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            padding: var(--space-16);
            margin-top: var(--space-24);
        }

        .location-display h3 {
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-semibold);
            margin-bottom: var(--space-12);
        }

        .location-info {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            margin-bottom: var(--space-8);
        }

        .location-coords {
            font-family: monospace;
            font-size: var(--font-size-sm);
            background: var(--color-surface);
            padding: var(--space-8);
            border-radius: var(--radius-base);
            margin-top: var(--space-8);
        }

        .status-badge {
            display: inline-block;
            padding: var(--space-4) var(--space-12);
            border-radius: var(--radius-full);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            background: rgba(var(--color-teal-500-rgb), 0.15);
            color: var(--color-success);
            border: 1px solid rgba(var(--color-teal-500-rgb), 0.25);
        }

        .empty-state {
            text-align: center;
            padding: var(--space-32);
            color: var(--color-text-secondary);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: var(--space-16);
        }

        .section-title {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-bold);
            margin-bottom: var(--space-16);
            color: var(--color-text);
        }

        .alert {
            padding: var(--space-12);
            border-radius: var(--radius-base);
            margin-bottom: var(--space-16);
            font-size: var(--font-size-sm);
        }

        .alert--error {
            background: rgba(var(--color-red-500-rgb), 0.1);
            color: var(--color-error);
            border: 1px solid rgba(var(--color-red-500-rgb), 0.2);
        }

        .alert--success {
            background: rgba(var(--color-teal-500-rgb), 0.1);
            color: var(--color-success);
            border: 1px solid rgba(var(--color-teal-500-rgb), 0.2);
        }

        .hidden {
            display: none;
        }

        .user-info {
            background: var(--color-secondary);
            padding: var(--space-16);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-24);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-name {
            font-weight: var(--font-weight-semibold);
            font-size: var(--font-size-lg);
        }

        .user-email {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
        }

        .sos-container {
            text-align: center;
            padding: var(--space-24) 0;
        }

        .sos-description {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            margin-bottom: var(--space-24);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1>üõ°Ô∏è Tourist Raksha Kavach</h1>
            <p>Your Safety Companion</p>
        </div>

        <!-- Login Screen -->
        <div id="loginScreen" class="content">
            <div class="auth-form">
                <h2 class="section-title" style="text-align: center;">Login</h2>
                <div id="loginError" class="alert alert--error hidden"></div>
                <form id="loginForm">
                    <div class="form-group">
                        <label class="form-label" for="loginEmail">Email</label>
                        <input type="email" id="loginEmail" class="form-control" placeholder="Enter your email" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" class="form-control" placeholder="Enter your password" required>
                    </div>
                    <button type="submit" class="btn btn--primary">Login</button>
                </form>
                <a class="text-link" id="showRegisterLink">Don't have an account? Register</a>
            </div>
        </div>

        <!-- Register Screen -->
        <div id="registerScreen" class="content hidden">
            <div class="auth-form">
                <h2 class="section-title" style="text-align: center;">Register</h2>
                <div id="registerError" class="alert alert--error hidden"></div>
                <div id="registerSuccess" class="alert alert--success hidden"></div>
                <form id="registerForm">
                    <div class="form-group">
                        <label class="form-label" for="registerName">Full Name</label>
                        <input type="text" id="registerName" class="form-control" placeholder="Enter your full name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="registerEmail">Email</label>
                        <input type="email" id="registerEmail" class="form-control" placeholder="Enter your email" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="registerPassword">Password</label>
                        <input type="password" id="registerPassword" class="form-control" placeholder="Create a password" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="registerPhone">Phone Number</label>
                        <input type="tel" id="registerPhone" class="form-control" placeholder="Enter your phone number" required>
                    </div>
                    <button type="submit" class="btn btn--primary">Register</button>
                </form>
                <a class="text-link" id="showLoginLink">Already have an account? Login</a>
            </div>
        </div>

        <!-- Main Dashboard Screen -->
        <div id="dashboardScreen" class="content hidden">
            <div class="user-info">
                <div>
                    <div class="user-name" id="userName"></div>
                    <div class="user-email" id="userEmail"></div>
                </div>
                <button class="btn btn--secondary btn--small" id="logoutBtn">Logout</button>
            </div>

            <!-- SOS Section -->
            <div class="sos-container">
                <h2 class="section-title">Emergency SOS</h2>
                <p class="sos-description">Press and hold the button for 2 seconds to activate emergency alert</p>
                <button class="btn btn--danger" id="sosBtn">
                    üö®<br>SOS<br>ALERT
                </button>
            </div>

            <!-- SOS Contacts Section -->
            <div>
                <h2 class="section-title">Your SOS Contacts</h2>
                <div id="contactsList"></div>
                <button class="btn btn--secondary" id="addContactBtn" style="margin-top: var(--space-12);">+ Add SOS Contact</button>
            </div>

            <!-- Emergency Services -->
            <div>
                <h2 class="section-title" style="margin-top: var(--space-32);">Emergency Services</h2>
                <div class="emergency-services">
                    <div class="service-btn" onclick="callEmergency('100', 'Police')">
                        <div class="service-btn-icon">üëÆ</div>
                        <div class="service-btn-label">Police</div>
                        <div class="service-btn-number">100</div>
                    </div>
                    <div class="service-btn" onclick="callEmergency('102', 'Ambulance')">
                        <div class="service-btn-icon">üöë</div>
                        <div class="service-btn-label">Ambulance</div>
                        <div class="service-btn-number">102</div>
                    </div>
                    <div class="service-btn" onclick="callEmergency('101', 'Fire Service')">
                        <div class="service-btn-icon">üöí</div>
                        <div class="service-btn-label">Fire Service</div>
                        <div class="service-btn-number">101</div>
                    </div>
                    <div class="service-btn" onclick="callEmergency('1091', 'Women Helpline')">
                        <div class="service-btn-icon">üë©</div>
                        <div class="service-btn-label">Women Helpline</div>
                        <div class="service-btn-number">1091</div>
                    </div>
                </div>
            </div>

            <!-- Location Tracking -->
            <div class="location-display">
                <h3>üìç Your Current Location</h3>
                <div class="location-info">
                    <span class="status-badge" id="locationStatus">Tracking Active</span>
                </div>
                <div class="location-coords" id="locationCoords">Getting location...</div>
                <button class="btn btn--secondary btn--small" id="refreshLocationBtn" style="margin-top: var(--space-12);">Refresh Location</button>
            </div>
        </div>

        <!-- Add Contact Modal -->
        <div id="addContactModal" class="content hidden">
            <div class="auth-form">
                <h2 class="section-title" style="text-align: center;">Add SOS Contact</h2>
                <form id="addContactForm">
                    <div class="form-group">
                        <label class="form-label" for="contactName">Contact Name</label>
                        <input type="text" id="contactName" class="form-control" placeholder="Enter contact name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="contactPhone">Phone Number</label>
                        <input type="tel" id="contactPhone" class="form-control" placeholder="Enter phone number" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="contactRelation">Relationship</label>
                        <input type="text" id="contactRelation" class="form-control" placeholder="e.g., Friend, Family" required>
                    </div>
                    <button type="submit" class="btn btn--primary">Save Contact</button>
                    <button type="button" class="btn btn--secondary" id="cancelAddContactBtn" style="margin-top: var(--space-8);">Cancel</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // In-memory data storage
        let users = [];
        let currentUser = null;
        let userContacts = {};
        let locationWatchId = null;
        let currentLocation = null;
        let sosTimeout = null;

        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            initializeApp();
        });

        function initializeApp() {
            // Check if user is logged in
            if (currentUser) {
                showDashboard();
            } else {
                showLogin();
            }

            // Event listeners
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('registerForm').addEventListener('submit', handleRegister);
            document.getElementById('showRegisterLink').addEventListener('click', showRegister);
            document.getElementById('showLoginLink').addEventListener('click', showLogin);
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            document.getElementById('addContactBtn').addEventListener('click', showAddContactModal);
            document.getElementById('cancelAddContactBtn').addEventListener('click', hideAddContactModal);
            document.getElementById('addContactForm').addEventListener('submit', handleAddContact);
            document.getElementById('refreshLocationBtn').addEventListener('click', getCurrentLocation);

            // SOS button with press and hold
            const sosBtn = document.getElementById('sosBtn');
            sosBtn.addEventListener('mousedown', startSOSTimer);
            sosBtn.addEventListener('mouseup', cancelSOSTimer);
            sosBtn.addEventListener('mouseleave', cancelSOSTimer);
            sosBtn.addEventListener('touchstart', startSOSTimer);
            sosBtn.addEventListener('touchend', cancelSOSTimer);
        }

        function showScreen(screenId) {
            const screens = ['loginScreen', 'registerScreen', 'dashboardScreen', 'addContactModal'];
            screens.forEach(screen => {
                document.getElementById(screen).classList.add('hidden');
            });
            document.getElementById(screenId).classList.remove('hidden');
        }

        function showLogin() {
            showScreen('loginScreen');
        }

        function showRegister() {
            showScreen('registerScreen');
        }

        function showDashboard() {
            showScreen('dashboardScreen');
            if (currentUser) {
                document.getElementById('userName').textContent = currentUser.name;
                document.getElementById('userEmail').textContent = currentUser.email;
                loadContacts();
                startLocationTracking();
            }
        }

        function showAddContactModal() {
            showScreen('addContactModal');
        }

        function hideAddContactModal() {
            document.getElementById('addContactForm').reset();
            showDashboard();
        }

        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');

            const user = users.find(u => u.email === email && u.password === password);

            if (user) {
                currentUser = user;
                errorDiv.classList.add('hidden');
                document.getElementById('loginForm').reset();
                showDashboard();
            } else {
                errorDiv.textContent = 'Invalid email or password';
                errorDiv.classList.remove('hidden');
            }
        }

        function handleRegister(e) {
            e.preventDefault();
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const phone = document.getElementById('registerPhone').value;
            const errorDiv = document.getElementById('registerError');
            const successDiv = document.getElementById('registerSuccess');

            // Check if user already exists
            if (users.find(u => u.email === email)) {
                errorDiv.textContent = 'User with this email already exists';
                errorDiv.classList.remove('hidden');
                successDiv.classList.add('hidden');
                return;
            }

            // Create new user
            const newUser = { name, email, password, phone };
            users.push(newUser);
            userContacts[email] = [];

            errorDiv.classList.add('hidden');
            successDiv.textContent = 'Registration successful! Please login.';
            successDiv.classList.remove('hidden');
            document.getElementById('registerForm').reset();

            setTimeout(() => {
                showLogin();
                successDiv.classList.add('hidden');
            }, 2000);
        }

        function handleLogout() {
            currentUser = null;
            stopLocationTracking();
            showLogin();
        }

        function loadContacts() {
            const contactsList = document.getElementById('contactsList');
            const contacts = userContacts[currentUser.email] || [];

            if (contacts.length === 0) {
                contactsList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìû</div>
                        <p>No SOS contacts added yet.<br>Add trusted contacts for emergency situations.</p>
                    </div>
                `;
            } else {
                contactsList.innerHTML = contacts.map((contact, index) => `
                    <div class="contact-card">
                        <div class="contact-info">
                            <h3>${contact.name}</h3>
                            <p>${contact.phone} &bull; ${contact.relation}</p>
                        </div>
                        <button class="btn btn--secondary btn--small" onclick="removeContact(${index})">Remove</button>
                    </div>
                `).join('');
            }
        }

        function handleAddContact(e) {
            e.preventDefault();
            const name = document.getElementById('contactName').value;
            const phone = document.getElementById('contactPhone').value;
            const relation = document.getElementById('contactRelation').value;

            if (!userContacts[currentUser.email]) {
                userContacts[currentUser.email] = [];
            }

            userContacts[currentUser.email].push({ name, phone, relation });
            hideAddContactModal();
            loadContacts();
        }

        function removeContact(index) {
            if (confirm('Are you sure you want to remove this contact?')) {
                userContacts[currentUser.email].splice(index, 1);
                loadContacts();
            }
        }

        function startLocationTracking() {
            if ('geolocation' in navigator) {
                getCurrentLocation();
                locationWatchId = navigator.geolocation.watchPosition(
                    updateLocation,
                    handleLocationError,
                    { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 }
                );
            } else {
                document.getElementById('locationCoords').textContent = 'Geolocation not supported by your browser';
            }
        }

        function stopLocationTracking() {
            if (locationWatchId) {
                navigator.geolocation.clearWatch(locationWatchId);
                locationWatchId = null;
            }
        }

        function getCurrentLocation() {
            if ('geolocation' in navigator) {
                document.getElementById('locationCoords').textContent = 'Getting location...';
                navigator.geolocation.getCurrentPosition(updateLocation, handleLocationError);
            }
        }

        function updateLocation(position) {
            currentLocation = {
                latitude: position.coords.latitude,
                longitude: position.coords.longitude,
                accuracy: position.coords.accuracy
            };

            const coordsDiv = document.getElementById('locationCoords');
            coordsDiv.innerHTML = `
                <strong>Latitude:</strong> ${currentLocation.latitude.toFixed(6)}<br>
                <strong>Longitude:</strong> ${currentLocation.longitude.toFixed(6)}<br>
                <strong>Accuracy:</strong> ¬±${Math.round(currentLocation.accuracy)}m<br>
                <strong>Maps:</strong> <a href="https://www.google.com/maps?q=${currentLocation.latitude},${currentLocation.longitude}" target="_blank" rel="noopener noreferrer" style="color: var(--color-primary);">View on Google Maps</a>
            `;
        }

        function handleLocationError(error) {
            let message = 'Unable to retrieve location';
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    message = 'Location permission denied. Please enable location access.';
                    break;
                case error.POSITION_UNAVAILABLE:
                    message = 'Location information unavailable';
                    break;
                case error.TIMEOUT:
                    message = 'Location request timed out';
                    break;
            }
            document.getElementById('locationCoords').textContent = message;
        }

        function startSOSTimer() {
            sosTimeout = setTimeout(() => {
                activateSOS();
            }, 2000);
        }

        function cancelSOSTimer() {
            if (sosTimeout) {
                clearTimeout(sosTimeout);
                sosTimeout = null;
            }
        }

        function activateSOS() {
            const contacts = userContacts[currentUser.email] || [];
            
            let alertMessage = 'üö® EMERGENCY SOS ACTIVATED üö®\n\n';
            alertMessage += `User: ${currentUser.name}\n`;
            alertMessage += `Phone: ${currentUser.phone}\n\n`;
            
            if (currentLocation) {
                alertMessage += `Location:\nLat: ${currentLocation.latitude.toFixed(6)}\nLong: ${currentLocation.longitude.toFixed(6)}\n`;
                alertMessage += `Maps: https://www.google.com/maps?q=${currentLocation.latitude},${currentLocation.longitude}\n\n`;
            }
            
            if (contacts.length > 0) {
                alertMessage += 'Alerting SOS contacts:\n';
                contacts.forEach(contact => {
                    alertMessage += `‚Ä¢ ${contact.name} (${contact.phone})\n`;
                    // In a real app, this would send SMS/call
                    callContact(contact.phone, contact.name);
                });
            } else {
                alertMessage += 'No SOS contacts added.\n';
            }
            
            alertMessage += '\nAlso alerting emergency services...';
            alert(alertMessage);
            
            // Call emergency services
            callEmergency('100', 'Police (Emergency)');
        }

        function callContact(phone, name) {
            if (confirm(`Call ${name} at ${phone}?`)) {
                window.location.href = `tel:${phone}`;
            }
        }

        function callEmergency(number, service) {
            if (confirm(`Call ${service} (${number})?`)) {
                window.location.href = `tel:${number}`;
            }
        }
    </script>
	<!-- Modal markup for critical battery warning -->
<div id="battery-modal" style="
  display: none; 
  position: fixed; 
  top: 0; left: 0; width: 100%; height: 100%; 
  background: rgba(0,0,0,0.5); 
  z-index: 9999; 
  justify-content: center; 
  align-items: center; 
">
  <div style="
    background: #fff6f6; 
    color: #b40000; 
    padding: 32px; 
    border-radius: 12px; 
    box-shadow: 0px 2px 12px rgba(0,0,0,0.14); 
    text-align: center;
    max-width: 350px;
    margin: auto;
  ">
    <h2>Critical Battery Warning!</h2>
    <p>Your device battery is <strong>very low</strong>. Please charge soon to avoid interruption.</p>
    <button onclick="document.getElementById('battery-modal').style.display='none';">Dismiss</button>
  </div>
</div>

<script>
  if ('getBattery' in navigator) {
    navigator.getBattery().then(function(battery) {
      function showModal() {
        if (battery.level <= 0.15) {
          document.getElementById('battery-modal').style.display = 'flex';
        } else {
          document.getElementById('battery-modal').style.display = 'none';
        }
      }
      showModal();
      battery.addEventListener('levelchange', showModal);
    });
  }
</script>
<script>
  // Replace with your SOS contact sending function
  function sendLocationToSOSContacts(latitude, longitude) {
    // Example: POST request to your server API OR trigger SMS
    // You must use your own implementation here
    fetch('https://your-api.com/send-location', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({
        location: {lat: latitude, lng: longitude},
        message: 'Critical Battery! Location auto-sent.'
        // add your SOS contacts here if needed
      })
    })
    .then(res => res.ok ? alert('Location sent to SOS contacts!') : alert('Failed to send location.'))
    .catch(err => alert('Error sending location.'));
  }

  if ('getBattery' in navigator) {
    navigator.getBattery().then(function(battery) {
      function checkAndSendLocation() {
        if (battery.level <= 0.02) {
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
              sendLocationToSOSContacts(
                position.coords.latitude,
                position.coords.longitude
              );
            }, function(error) {
              alert('Unable to get location: ' + error.message);
            });
          } else {
            alert('Geolocation API not supported');
          }
        }
      }
      battery.addEventListener('levelchange', checkAndSendLocation);
      checkAndSendLocation();
    });
  }
</script>

</body>
</html>
